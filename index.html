<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HSK 4 | –ö–∏—Ç–∞–π—Å–∫–∏–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        html, body {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #8B0000;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #app {
            width: 100%;
            max-width: 390px;
            height: 100%;
            max-height: 844px;
            background: #FFF5F5;
            position: relative;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.3);
            border-radius: 40px;
            overflow: hidden;
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            background: #FFF5F5;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .screen.active {
            display: flex;
        }

        .status-bar {
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            font-size: 15px;
            font-weight: 600;
            color: #8B0000;
            background: #FFF5F5;
            flex-shrink: 0;
        }

        .red-button {
            background: #8B0000;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            width: 90%;
            margin: 0 auto;
            display: block;
            flex-shrink: 0;
        }

        .red-button-outline {
            background: white;
            color: #8B0000;
            border: 2px solid #8B0000;
        }

        /* –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ */
        .auth-container {
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            flex-shrink: 0;
        }

        .auth-logo {
            font-size: 48px;
            color: #8B0000;
            margin-bottom: 20px;
        }

        .auth-title {
            font-size: 28px;
            color: #8B0000;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .auth-subtitle {
            color: #666;
            margin-bottom: 30px;
            text-align: center;
        }

        .auth-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #FFE4E1;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 15px;
            background: white;
            -webkit-user-select: text;
            user-select: text;
        }

        .auth-input:focus {
            border-color: #8B0000;
            outline: none;
        }

        .auth-button {
            width: 100%;
            padding: 16px;
            background: #8B0000;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .auth-link {
            color: #8B0000;
            text-decoration: none;
            font-size: 15px;
            cursor: pointer;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            margin: 20px 0;
            color: #999;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: "";
            flex: 1;
            height: 1px;
            background: #FFE4E1;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: white;
            border-bottom: 1px solid #FFE4E1;
            flex-shrink: 0;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 20px;
            background: #8B0000;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .user-email {
            flex: 1;
            font-size: 14px;
            color: #333;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .logout-btn {
            padding: 8px 12px;
            background: #FFE4E1;
            border: none;
            border-radius: 8px;
            color: #8B0000;
            font-size: 13px;
            cursor: pointer;
            flex-shrink: 0;
        }

        /* HSK —É—Ä–æ–≤–Ω–∏ */
        .hsk-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px;
            flex-shrink: 0;
        }

        .hsk-card {
            background: white;
            border-radius: 20px;
            padding: 20px 10px;
            text-align: center;
            border: 2px solid #FFE4E1;
            cursor: pointer;
        }

        .hsk-card.active {
            border-color: #8B0000;
            background: #FFE4E1;
        }

        .hsk-card .level {
            font-size: 24px;
            font-weight: 700;
            color: #8B0000;
            margin-bottom: 5px;
        }

        .hsk-card .words-count {
            font-size: 14px;
            color: #666;
        }

        /* –ë–ª–æ–∫–∏ —Å–ª–æ–≤ —Å –∏–∫–æ–Ω–∫–∞–º–∏ */
        .section-title {
            padding: 0 20px 10px;
            font-size: 18px;
            font-weight: 600;
            color: #8B0000;
            border-bottom: 2px solid #FFE4E1;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .blocks-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 0 20px 20px;
            flex-shrink: 0;
        }

        .block-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            border: 1px solid #FFE4E1;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .block-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .block-icon {
            font-size: 20px;
        }

        .block-name {
            font-size: 14px;
            font-weight: 600;
            color: #8B0000;
        }

        .block-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .block-progress {
            height: 6px;
            background: #FFE4E1;
            border-radius: 3px;
            overflow: hidden;
        }

        .block-progress-fill {
            height: 100%;
            background: #8B0000;
            width: 0%;
        }

        /* –ë–∞–Ω–Ω–µ—Ä –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è */
        .review-banner {
            background: #8B0000;
            margin: 15px 20px;
            padding: 16px;
            border-radius: 16px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            animation: pulse 2s infinite;
            flex-shrink: 0;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* –ö–æ–ª—å—Ü–µ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ */
        .progress-circle {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
        }

        .progress-circle svg {
            width: 120px;
            height: 120px;
            transform: rotate(-90deg);
        }

        .progress-circle circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .progress-circle .bg-circle {
            stroke: #FFE4E1;
        }

        .progress-circle .progress-circle-fill {
            stroke: #8B0000;
            stroke-dasharray: 314;
            stroke-dashoffset: 314;
            transition: stroke-dashoffset 0.5s;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-text .percentage {
            font-size: 24px;
            font-weight: 700;
            color: #8B0000;
        }

        .progress-text .label {
            font-size: 12px;
            color: #666;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–ª–æ–≤–∞ */
        .word-card {
            background: white;
            border-radius: 24px;
            padding: 30px 20px;
            margin: 20px;
            border: 2px solid #FFE4E1;
            text-align: center;
            box-shadow: 0 8px 20px rgba(139, 0, 0, 0.15);
        }

        .word-card-chinese {
            font-size: 64px;
            font-weight: 600;
            color: #8B0000;
            margin-bottom: 10px;
            font-family: 'KaiTi', 'Ê•∑‰Ωì', 'STKaiti', serif;
        }

        .word-card-pinyin {
            font-size: 28px;
            color: #A52A2A;
            margin-bottom: 15px;
        }

        .word-card-translation {
            font-size: 24px;
            color: #8B0000;
            margin-bottom: 25px;
            font-weight: 500;
            padding: 10px;
            background: #FFF5F5;
            border-radius: 16px;
        }

        .word-card-example {
            background: #FFF5F5;
            padding: 20px;
            border-radius: 16px;
            margin: 15px 0;
            border: 1px solid #FFE4E1;
        }

        .word-card-example-chinese {
            font-size: 20px;
            margin-bottom: 8px;
            color: #8B0000;
        }

        .word-card-example-translation {
            color: #666;
            font-size: 16px;
        }

        .word-card-audio {
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: #8B0000;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px auto;
            cursor: pointer;
            font-size: 28px;
            color: white;
            box-shadow: 0 4px 10px rgba(139, 0, 0, 0.3);
        }

        .word-card-audio:active {
            transform: scale(0.95);
        }

        .word-card-close {
            margin-top: 20px;
            padding: 12px 24px;
            background: #FFE4E1;
            border: none;
            border-radius: 30px;
            color: #8B0000;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        /* –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –≤ –±–ª–æ–∫–µ */
        .words-list {
            padding: 0 20px 20px;
        }

        .word-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #FFE4E1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .word-item:active {
            transform: scale(0.98);
            background: #FFE4E1;
        }

        .word-item-left {
            display: flex;
            flex-direction: column;
        }

        .word-item .chinese {
            font-size: 18px;
            font-weight: 600;
            color: #8B0000;
        }

        .word-item .pinyin-small {
            font-size: 14px;
            color: #A52A2A;
        }

        .word-item .translation-small {
            font-size: 14px;
            color: #666;
        }

        .word-item .mastered-badge {
            background: #4CAF50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .word-item .not-mastered-badge {
            background: #FFE4E1;
            color: #8B0000;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–ª–æ–∫–∞ */
        .block-progress-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 20px;
            border: 1px solid #FFE4E1;
        }

        .block-progress-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .block-progress-bar-big {
            height: 12px;
            background: #FFE4E1;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .block-progress-fill-big {
            height: 100%;
            background: #8B0000;
            width: 0%;
            border-radius: 6px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ */
        .choice-char-trans-only {
            padding: 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .choice-char-trans-only .translation-big {
            font-size: 36px;
            color: #8B0000;
            font-weight: 700;
            margin: 30px 0 40px;
        }

        .options-vertical {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
        }

        .option-vertical-item {
            background: white;
            border: 2px solid #FFE4E1;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: 0.2s;
        }

        .option-vertical-item:active {
            transform: scale(0.98);
        }

        .option-vertical-item .chinese-small {
            font-size: 24px;
            font-weight: 600;
            color: #8B0000;
            min-width: 80px;
        }

        .option-vertical-item .pinyin-small {
            font-size: 16px;
            color: #A52A2A;
            flex: 1;
        }

        .option-vertical-item.correct {
            background: #4CAF50;
            border-color: #4CAF50;
        }

        .option-vertical-item.correct .chinese-small,
        .option-vertical-item.correct .pinyin-small {
            color: white;
        }

        .option-vertical-item.wrong {
            background: #f44336;
            border-color: #f44336;
        }

        .option-vertical-item.wrong .chinese-small,
        .option-vertical-item.wrong .pinyin-small {
            color: white;
        }

        .chinese-char {
            font-size: 56px;
            font-weight: 600;
            color: #8B0000;
            text-align: center;
            margin: 30px 0 15px;
        }

        .pinyin {
            font-size: 24px;
            color: #A52A2A;
            text-align: center;
            margin-bottom: 10px;
        }

        .translation {
            font-size: 20px;
            color: #8B0000;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .example-box {
            background: white;
            padding: 20px;
            border-radius: 16px;
            margin: 20px;
            border: 1px solid #FFE4E1;
        }

        .example-chinese {
            font-size: 18px;
            margin-bottom: 8px;
            color: #8B0000;
        }

        .example-translation {
            color: #666;
            font-size: 15px;
        }

        .audio-btn {
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: #8B0000;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px auto;
            cursor: pointer;
            font-size: 28px;
            color: white;
            touch-action: manipulation;
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        .char-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 20px;
        }

        .char-btn {
            width: 70px;
            height: 70px;
            background: white;
            border: 2px solid #FFE4E1;
            border-radius: 12px;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #8B0000;
            touch-action: manipulation;
        }

        .char-btn:active {
            transform: scale(0.95);
            background: #FFE4E1;
        }

        .char-btn.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        /* –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ */
        .matching-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin: 10px 20px;
            border: 2px solid #FFE4E1;
        }

        .matching-title {
            font-size: 18px;
            color: #8B0000;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .char-pinyin-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .char-pinyin-row {
            background: #FFF5F5;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid #FFE4E1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .char-pinyin-row .char {
            font-size: 24px;
            font-weight: 600;
            color: #8B0000;
            width: 60px;
        }

        .pinyin-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .pinyin-option {
            padding: 8px 12px;
            background: white;
            border: 1px solid #FFE4E1;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            color: #666;
        }

        .pinyin-option.selected {
            background: #8B0000;
            color: white;
        }

        .pinyin-option.matched {
            background: #4CAF50;
            color: white;
            cursor: default;
        }

        .word-translation-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .word-translation-row {
            background: #FFF5F5;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #FFE4E1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .word-translation-row .word {
            font-size: 20px;
            font-weight: 600;
            color: #8B0000;
        }

        .trans-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .trans-option {
            padding: 8px 12px;
            background: white;
            border: 1px solid #FFE4E1;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            color: #666;
        }

        .trans-option.selected {
            background: #8B0000;
            color: white;
        }

        .trans-option.matched {
            background: #4CAF50;
            color: white;
            cursor: default;
        }

        /* –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–ª–æ–∫–∞ */
        .block-complete {
            text-align: center;
            padding: 40px 20px;
        }

        .block-complete h2 {
            color: #8B0000;
            font-size: 32px;
            margin-bottom: 20px;
        }

        .block-complete p {
            color: #666;
            font-size: 18px;
            margin-bottom: 30px;
        }

        .block-complete-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 250px;
            margin: 0 auto;
        }

        .complete-button {
            padding: 16px 24px;
            background: #8B0000;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
        }

        .complete-button.outline {
            background: white;
            color: #8B0000;
            border: 2px solid #8B0000;
        }

        .card-header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            border-bottom: 1px solid #FFE4E1;
            flex-shrink: 0;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 4px;
            background: #FFE4E1;
            display: inline-block;
            margin: 0 2px;
        }

        .progress-dot.completed {
            background: #8B0000;
        }

        .bottom-nav {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #FFE4E1;
            background: white;
            margin-top: auto;
            flex-shrink: 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #999;
            font-size: 12px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .nav-item:active {
            color: #8B0000;
        }

        .nav-item.active {
            color: #8B0000;
        }

        .nav-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }

        .back-btn {
            font-size: 24px;
            cursor: pointer;
            color: white;
            touch-action: manipulation;
        }

        .back-btn:active {
            opacity: 0.7;
        }

        .scroll-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 20px;
        }

        .feedback-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            z-index: 1000;
            animation: popIn 0.5s;
            pointer-events: none;
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); }
            80% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
        <div id="auth-screen" class="screen active">
            <div class="status-bar">
                <span>9:41</span>
                <span>üîã 100%</span>
            </div>
            
            <div class="scroll-content">
                <div class="auth-container">
                    <div class="auth-logo">üÄÑÔ∏è</div>
                    <div class="auth-title">HSK 4</div>
                    <div class="auth-subtitle">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</div>
                    
                    <div style="width: 100%;">
                        <input type="email" id="login-email" class="auth-input" placeholder="Email" value="user@example.com">
                        <input type="password" id="login-password" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å" value="123456">
                        <button class="auth-button" id="login-btn">–í–æ–π—Ç–∏</button>
                        
                        <div class="auth-divider">–∏–ª–∏</div>
                        
                        <button class="auth-button" id="register-btn" style="background: white; color: #8B0000; border: 2px solid #8B0000;">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <span class="auth-link" id="guest-link">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–∞–∫ –≥–æ—Å—Ç—å</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div id="register-screen" class="screen">
            <div class="status-bar">
                <span>9:41</span>
                <span>üîã 100%</span>
            </div>
            
            <div style="padding: 20px; flex-shrink: 0;">
                <span class="back-btn" id="back-to-auth" style="color: #8B0000; font-size: 24px; cursor: pointer;">‚Üê</span>
            </div>
            
            <div class="scroll-content">
                <div class="auth-container">
                    <div class="auth-logo">üÄÑÔ∏è</div>
                    <div class="auth-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
                    <div class="auth-subtitle">–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</div>
                    
                    <div style="width: 100%;">
                        <input type="text" id="register-name" class="auth-input" placeholder="–ò–º—è" value="–í–ª–∞–¥–∞">
                        <input type="email" id="register-email" class="auth-input" placeholder="Email" value="vladamalova@example.com">
                        <input type="password" id="register-password" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å" value="123456">
                        <input type="password" id="register-confirm" class="auth-input" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" value="123456">
                        <button class="auth-button" id="register-submit-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω —Å HSK —É—Ä–æ–≤–Ω—è–º–∏ -->
        <div id="hsk-screen" class="screen">
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar">–í</div>
                <div class="user-email" id="user-email">vladamalova@example.com</div>
                <button class="logout-btn" id="logout-btn">–í—ã–π—Ç–∏</button>
            </div>
            
            <div class="status-bar">
                <span>9:41</span>
                <span>üîã 100%</span>
            </div>
            
            <div class="scroll-content">
                <div style="padding: 20px;">
                    <h1 style="font-size: 32px; color: #8B0000; margin-bottom: 5px;">HSK Ê±âËØ≠</h1>
                    <p style="color: #666; margin-bottom: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å</p>
                </div>
                
                <div class="hsk-grid" id="hsk-grid">
                    <div class="hsk-card" data-hsk="1">
                        <div class="level">HSK 1</div>
                        <div class="words-count">150 —Å–ª–æ–≤</div>
                    </div>
                    <div class="hsk-card" data-hsk="2">
                        <div class="level">HSK 2</div>
                        <div class="words-count">300 —Å–ª–æ–≤</div>
                    </div>
                    <div class="hsk-card" data-hsk="3">
                        <div class="level">HSK 3</div>
                        <div class="words-count">600 —Å–ª–æ–≤</div>
                    </div>
                    <div class="hsk-card active" data-hsk="4">
                        <div class="level">HSK 4</div>
                        <div class="words-count">1200 —Å–ª–æ–≤</div>
                    </div>
                    <div class="hsk-card" data-hsk="5">
                        <div class="level">HSK 5</div>
                        <div class="words-count">1300 —Å–ª–æ–≤</div>
                    </div>
                    <div class="hsk-card" data-hsk="6">
                        <div class="level">HSK 6</div>
                        <div class="words-count">2500+ —Å–ª–æ–≤</div>
                    </div>
                </div>
                
                <div style="padding: 20px;">
                    <button class="red-button" id="select-hsk-btn" style="width: 100%;">–í—ã–±—Ä–∞—Ç—å HSK 4</button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Å –±–ª–æ–∫–∞–º–∏ —Å–ª–æ–≤ HSK 4 -->
        <div id="blocks-screen" class="screen">
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar-blocks">–í</div>
                <div class="user-email" id="user-email-blocks">vladamalova@example.com</div>
                <button class="logout-btn" id="logout-btn-blocks">–í—ã–π—Ç–∏</button>
            </div>
            
            <div class="status-bar">
                <span>9:41</span>
                <span>üîã 100%</span>
            </div>
            <div style="background: #8B0000; color: white; padding: 15px; display: flex; align-items: center; gap: 15px; flex-shrink: 0;">
                <span class="back-btn" id="back-to-hsk">‚Üê</span>
                <h2 style="font-size: 24px;">HSK 4</h2>
            </div>
            
            <div class="scroll-content">
                <div id="review-banner" class="review-banner" style="display: none;">
                    <span>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–ª–æ–≤–∞</span>
                    <span id="review-count">0</span>
                </div>
                
                <div style="padding: 20px;">
                    <div style="background: white; border-radius: 20px; padding: 20px; border: 1px solid #FFE4E1;">
                        <div style="font-size: 18px; color: #8B0000; font-weight: 600; margin-bottom: 15px;">–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å HSK 4</div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>–í—ã—É—á–µ–Ω–æ —Å–ª–æ–≤:</span>
                            <span style="color: #8B0000; font-weight: 600;" id="total-mastered">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <span>–í—Å–µ–≥–æ —Å–ª–æ–≤:</span>
                            <span style="color: #666;" id="total-words">1200</span>
                        </div>
                        <div style="height: 10px; background: #FFE4E1; border-radius: 5px;">
                            <div id="total-progress" style="height: 100%; background: #8B0000; width: 0%; border-radius: 5px;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="section-title">–¢–µ–º—ã HSK 4</div>
                <div class="blocks-grid" id="blocks-container"></div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –±–ª–æ–∫–∞ -->
        <div id="block-detail-screen" class="screen">
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar-detail">–í</div>
                <div class="user-email" id="user-email-detail">vladamalova@example.com</div>
                <button class="logout-btn" id="logout-btn-detail">–í—ã–π—Ç–∏</button>
            </div>
            
            <div class="status-bar">
                <span>9:41</span>
                <span>üîã 100%</span>
            </div>
            <div style="background: #8B0000; color: white; padding: 15px; display: flex; align-items: center; gap: 15px; flex-shrink: 0;">
                <span class="back-btn" id="back-to-blocks">‚Üê</span>
                <h2 id="block-title" style="font-size: 24px;">–ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏</h2>
            </div>
            
            <div class="scroll-content">
                <div class="block-progress-container">
                    <div class="block-progress-stats">
                        <span>–ü—Ä–æ–≥—Ä–µ—Å—Å –±–ª–æ–∫–∞</span>
                        <span id="block-mastered-count">0/0</span>
                    </div>
                    <div class="block-progress-bar-big">
                        <div class="block-progress-fill-big" id="block-progress-bar" style="width: 0%"></div>
                    </div>
                    <button class="red-button" id="study-block-btn" style="width: 100%;">–£—á–∏—Ç—å —Å–ª–æ–≤–∞</button>
                </div>
                
                <div class="section-title">–°–ø–∏—Å–æ–∫ —Å–ª–æ–≤</div>
                <div class="words-list" id="words-list-container"></div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–ª–æ–≤–∞ -->
        <div id="word-card-screen" class="screen">
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar-card">–í</div>
                <div class="user-email" id="user-email-card">vladamalova@example.com</div>
                <button class="logout-btn" id="logout-btn-card">–í—ã–π—Ç–∏</button>
            </div>
            
            <div class="status-bar">
                <span>9:41</span>
                <span>üîã 100%</span>
            </div>
            
            <div style="padding: 15px; flex-shrink: 0;">
                <span class="back-btn" id="back-to-block-from-card" style="color: #8B0000; font-size: 24px; cursor: pointer;">‚Üê</span>
            </div>
            
            <div class="scroll-content" id="word-card-content"></div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
        <div id="study-screen" class="screen">
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar-study">–í</div>
                <div class="user-email" id="user-email-study">vladamalova@example.com</div>
                <button class="logout-btn" id="logout-btn-study">–í—ã–π—Ç–∏</button>
            </div>
            
            <div class="card-header">
                <div id="progress-dots"></div>
                <span class="skip-btn" id="skip-btn" style="color: #8B0000; cursor: pointer;">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</span>
            </div>
            <div class="scroll-content" id="card-content"></div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
        <div id="post-study-screen" class="screen">
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar-post">–í</div>
                <div class="user-email" id="user-email-post">vladamalova@example.com</div>
                <button class="logout-btn" id="logout-btn-post">–í—ã–π—Ç–∏</button>
            </div>
            
            <div class="scroll-content">
                <div style="text-align: center; padding: 50px 20px;">
                    <div style="font-size: 60px; margin-bottom: 20px;">üéâ</div>
                    <h2 style="font-size: 24px; color: #8B0000; margin-bottom: 10px;">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</h2>
                    <p style="color: #666; margin-bottom: 30px;" id="study-result"></p>
                    <button class="red-button" id="continue-study" style="margin: 10px auto;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                    <button class="red-button red-button-outline" id="back-to-block-after" style="margin: 10px auto;">–ö —Å–ø–∏—Å–∫—É —Å–ª–æ–≤</button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–ª–æ–∫–∞ -->
        <div id="block-complete-screen" class="screen">
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar-complete">–í</div>
                <div class="user-email" id="user-email-complete">vladamalova@example.com</div>
                <button class="logout-btn" id="logout-btn-complete">–í—ã–π—Ç–∏</button>
            </div>
            
            <div class="status-bar">
                <span>9:41</span>
                <span>üîã 100%</span>
            </div>
            
            <div class="scroll-content">
                <div class="block-complete">
                    <div style="font-size: 80px; margin-bottom: 20px;">üèÜ</div>
                    <h2>–ë–ª–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω!</h2>
                    <p>–í—ã –≤—ã—É—á–∏–ª–∏ –≤—Å–µ —Å–ª–æ–≤–∞ –≤ —ç—Ç–æ–º –±–ª–æ–∫–µ. –•–æ—Ç–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å?</p>
                    
                    <div class="block-complete-buttons">
                        <button class="complete-button" id="review-block-btn">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å 10 —Å–ª–æ–≤</button>
                        <button class="complete-button outline" id="back-to-blocks-complete">–ö —Å–ø–∏—Å–∫—É –±–ª–æ–∫–æ–≤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="feedback-overlay" class="feedback-overlay" style="display: none;"></div>

    <script>
        // ============================================
        // –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
        // ============================================
        
        let users = {};
        let currentUser = null;
        
        function loadUsers() {
            const saved = localStorage.getItem('hsk4_users');
            if (saved) {
                users = JSON.parse(saved);
            } else {
                users = {
                    'vladamalova@example.com': {
                        name: '–í–ª–∞–¥–∞',
                        email: 'vladamalova@example.com',
                        password: '123456',
                        progress: {}
                    }
                };
                saveUsers();
            }
        }
        
        function saveUsers() {
            localStorage.setItem('hsk4_users', JSON.stringify(users));
        }
        
        function loadUserProgress() {
            if (!currentUser) return;
            
            const user = users[currentUser];
            if (user && user.progress) {
                wordsData.forEach(word => {
                    if (user.progress[word.id]) {
                        word.mastered = user.progress[word.id].mastered || 0;
                        word.timesReviewed = user.progress[word.id].timesReviewed || 0;
                        word.correctCount = user.progress[word.id].correctCount || 0;
                        word.lastReviewed = user.progress[word.id].lastReviewed || null;
                    } else {
                        word.mastered = 0;
                        word.timesReviewed = 0;
                        word.correctCount = 0;
                        word.lastReviewed = null;
                    }
                });
            }
        }
        
        function saveUserProgress() {
            if (!currentUser) return;
            
            const progress = {};
            wordsData.forEach(word => {
                progress[word.id] = {
                    mastered: word.mastered,
                    timesReviewed: word.timesReviewed,
                    correctCount: word.correctCount,
                    lastReviewed: word.lastReviewed
                };
            });
            
            if (users[currentUser]) {
                users[currentUser].progress = progress;
                saveUsers();
            }
        }
        
        function updateUserUI() {
            const user = currentUser ? users[currentUser] : null;
            const userInitial = user ? user.name.charAt(0).toUpperCase() : '–ì';
            const userEmail = user ? user.email : '–ì–æ—Å—Ç—å';
            
            document.querySelectorAll('[id^="user-avatar"]').forEach(el => {
                el.textContent = userInitial;
            });
            
            document.querySelectorAll('[id^="user-email"]').forEach(el => {
                el.textContent = userEmail;
            });
        }
        
        function logout() {
            saveUserProgress();
            currentUser = null;
            showScreen('auth-screen');
        }

        // ============================================
        // –í–°–ï –í–ê–®–ò –°–õ–û–í–ê HSK 4
        // ============================================
        
        const wordsData = [
            { id: 1, characters: "Âπ≤ÊùØ", pinyin: "gƒÅn bƒìi", translation: "—á–æ–∫–∞—Ç—å—Å—è / –¥–æ –¥–Ω–∞", example: "Êàë‰ª¨Êù•Âπ≤ÊùØÔºÅ", exampleTranslation: "–î–∞–≤–∞–π—Ç–µ —á–æ–∫–Ω–µ–º—Å—è!", listId: 1, mastered: 0, timesReviewed: 0, correctCount: 0, lastReviewed: null },
            { id: 2, characters: "È•ºÂπ≤", pinyin: "b«êng gƒÅn", translation: "–ø–µ—á–µ–Ω—å–µ", example: "ÊàëÂñúÊ¨¢ÂêÉÈ•ºÂπ≤„ÄÇ", exampleTranslation: "–Ø –ª—é–±–ª—é –µ—Å—Ç—å –ø–µ—á–µ–Ω—å–µ.", listId: 1, mastered: 0, timesReviewed: 0, correctCount: 0, lastReviewed: null },
            { id: 3, characters: "È•∫Â≠ê", pinyin: "ji«éo zi", translation: "–ø–µ–ª—å–º–µ–Ω–∏ / —Ü–∑—è–æ—Ü–∑—ã", example: "Â¶àÂ¶àÂåÖ‰∫ÜÈ•∫Â≠ê„ÄÇ", exampleTranslation: "–ú–∞–º–∞ —Å–ª–µ–ø–∏–ª–∞ –ø–µ–ª—å–º–µ–Ω–∏.", listId: 1, mastered: 0, timesReviewed: 0, correctCount: 0, lastReviewed: null },
            { id: 4, characters: "Ê±§", pinyin: "tƒÅng", translation: "—Å—É–ø", example: "Ê±§ÂæàÁÉ≠„ÄÇ", exampleTranslation: "–°—É–ø –≥–æ—Ä—è—á–∏–π.", listId: 1, mastered: 0, timesReviewed: 0, correctCount: 0, lastReviewed: null },
            { id: 5, characters: "Ë•øÁ∫¢Êüø", pinyin: "xƒ´ h√≥ng sh√¨", translation: "–ø–æ–º–∏–¥–æ—Ä", example: "Ë•øÁ∫¢ÊüøÁÇíÈ∏°Ëõã", exampleTranslation: "–Ø–∏—á–Ω–∏—Ü–∞ —Å –ø–æ–º–∏–¥–æ—Ä–∞–º–∏.", listId: 1, mastered: 0, timesReviewed: 0, correctCount: 0, lastReviewed: null }
        ];

        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞ –¥–æ 1200
        for (let i = 6; i <= 1200; i++) {
            wordsData.push({
                id: i,
                characters: `ËØç${i}`,
                pinyin: `c√≠ ${i}`,
                translation: `—Å–ª–æ–≤–æ ${i}`,
                example: `ËøôÊòØËØç${i}„ÄÇ`,
                exampleTranslation: `–≠—Ç–æ —Å–ª–æ–≤–æ ${i}.`,
                listId: Math.floor(i / 45) + 1,
                mastered: 0,
                timesReviewed: 0,
                correctCount: 0,
                lastReviewed: null
            });
        }

        // –ë–ª–æ–∫–∏ (27 —Ç–µ–º)
        const blocks = [
            { id: 1, name: "–ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏", icon: "üçú", count: 20 },
            { id: 2, name: "–û–±—É—á–µ–Ω–∏–µ", icon: "üìö", count: 20 },
            { id: 3, name: "–†–∞–±–æ—Ç–∞ –∏ –¥–µ–Ω—å–≥–∏", icon: "üíº", count: 24 },
            { id: 4, name: "–£—Å–ø–µ—Ö –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ", icon: "üìà", count: 23 },
            { id: 5, name: "–°–µ–º—å—è –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è", icon: "üë®‚Äçüë©‚Äçüëß", count: 33 },
            { id: 6, name: "–≠–º–æ—Ü–∏–∏ –∏ —á—É–≤—Å—Ç–≤–∞", icon: "‚ù§Ô∏è", count: 30 },
            { id: 7, name: "–õ–∏—á–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞", icon: "‚≠ê", count: 23 },
            { id: 8, name: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è", icon: "‚úàÔ∏è", count: 18 },
            { id: 9, name: "–ö–ª–∏–º–∞—Ç –∏ –ø—Ä–∏—Ä–æ–¥–∞", icon: "üå¶Ô∏è", count: 27 },
            { id: 10, name: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", icon: "üé≠", count: 23 },
            { id: 11, name: "–ù–∞—Ä–µ—á–∏—è 1", icon: "üìù", count: 23 },
            { id: 12, name: "–ù–∞—Ä–µ—á–∏—è 2", icon: "üìù", count: 22 },
            { id: 13, name: "–í—Ä–µ–º—è", icon: "‚è∞", count: 19 },
            { id: 14, name: "–ü–æ–∫—É–ø–∫–∏", icon: "üõçÔ∏è", count: 20 },
            { id: 15, name: "–ó–∞–∫–æ–Ω –∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ", icon: "‚öñÔ∏è", count: 29 },
            { id: 16, name: "–≠–∫–æ–Ω–æ–º–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑", icon: "üìä", count: 27 },
            { id: 17, name: "–î–æ–º –∏ –±—ã—Ç", icon: "üè†", count: 31 },
            { id: 18, name: "–û—Ñ–∏—Å", icon: "üíª", count: 14 },
            { id: 19, name: "–ú–µ—Å—Ç–æ –∏ –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏–µ", icon: "üìç", count: 20 },
            { id: 20, name: "–î–∏–∞–ª–æ–≥ –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ", icon: "üí¨", count: 25 },
            { id: 21, name: "–£–º–æ–∑–∞–∫–ª—é—á–µ–Ω–∏—è", icon: "ü§î", count: 20 },
            { id: 22, name: "–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞", icon: "üîß", count: 11 },
            { id: 23, name: "–°–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞", icon: "üî§", count: 19 },
            { id: 24, name: "–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ", icon: "üìã", count: 28 },
            { id: 25, name: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", icon: "üì¢", count: 23 },
            { id: 26, name: "–ó–¥–æ—Ä–æ–≤—å–µ –∏ —Å–ø–æ—Ä—Ç", icon: "üè•", count: 23 },
            { id: 27, name: "–ì–ª–∞–≥–æ–ª—ã", icon: "üî®", count: 15 }
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let currentHSK = 4;
        let currentBlock = 1;
        let studyWords = [];
        let studyQueue = [];
        let currentIndex = 0;
        let studyBlockId = 1;

        // ============================================
        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –ü–†–û–ì–†–ï–°–°–û–ú
        // ============================================
        
        function getWordsByBlock(blockId) {
            return wordsData.filter(w => w.listId === blockId);
        }

        function getBlockStats(blockId) {
            const words = getWordsByBlock(blockId);
            const total = words.length;
            const mastered = words.filter(w => w.mastered >= 5).length;
            return { total, mastered };
        }

        function getTotalStats() {
            const total = wordsData.length;
            const mastered = wordsData.filter(w => w.mastered >= 5).length;
            return { total, mastered };
        }

        function getWordsForReview() {
            const now = Date.now();
            const twoDays = 2 * 24 * 60 * 60 * 1000;
            return wordsData.filter(word => {
                if (word.mastered >= 5) return false;
                if (!word.lastReviewed) return false;
                return (now - word.lastReviewed) >= twoDays;
            });
        }

        function updateReviewBanner() {
            const reviewWords = getWordsForReview();
            const banner = document.getElementById('review-banner');
            const countSpan = document.getElementById('review-count');
            if (reviewWords.length > 0) {
                banner.style.display = 'flex';
                countSpan.textContent = reviewWords.length;
            } else {
                banner.style.display = 'none';
            }
        }

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-CN';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        function showFeedback(isCorrect) {
            const overlay = document.getElementById('feedback-overlay');
            overlay.textContent = isCorrect ? '‚úì' : '‚úó';
            overlay.style.color = isCorrect ? '#4CAF50' : '#f44336';
            overlay.style.display = 'block';
            setTimeout(() => overlay.style.display = 'none', 500);
        }

        function updateCircleProgress(percentage) {
            const circle = document.getElementById('circle-progress');
            const circumference = 2 * Math.PI * 50;
            const offset = circumference - (percentage / 100) * circumference;
            circle.style.strokeDasharray = `${circumference}`;
            circle.style.strokeDashoffset = offset;
            document.getElementById('circle-percentage').textContent = `${Math.round(percentage)}%`;
        }

        function startStudy(blockId, newWords = true) {
            studyBlockId = blockId;
            const allWords = getWordsByBlock(blockId);
            
            if (newWords) {
                const unmastered = allWords.filter(w => w.mastered < 5);
                unmastered.sort((a, b) => a.correctCount - b.correctCount);
                studyWords = unmastered.slice(0, 5);
            } else {
                const inProgress = allWords.filter(w => w.mastered > 0 && w.mastered < 5);
                inProgress.sort((a, b) => a.correctCount - b.correctCount);
                studyWords = inProgress.slice(0, 5);
            }
            
            if (studyWords.length === 0) {
                alert('–í—Å–µ —Å–ª–æ–≤–∞ –≤ —ç—Ç–æ–º –±–ª–æ–∫–µ —É–∂–µ –≤—ã—É—á–µ–Ω—ã!');
                return;
            }
            
            createStudyQueue();
            currentIndex = 0;
            
            document.getElementById('block-detail-screen').classList.remove('active');
            document.getElementById('study-screen').classList.add('active');
            
            updateProgressDots();
            showTask();
        }

        function createStudyQueue() {
            studyQueue = [];
            studyWords.forEach(word => {
                studyQueue.push({ type: 'intro', word: word });
                studyQueue.push({ type: 'choice_char', word: word });
                studyQueue.push({ type: 'choice_trans', word: word });
                studyQueue.push({ type: 'char_from_trans', word: word });
                studyQueue.push({ type: 'listening', word: word });
                studyQueue.push({ type: 'compose', word: word });
                studyQueue.push({ type: 'matching', word: word });
                studyQueue.push({ type: 'review', word: word });
            });
            studyQueue = shuffleArray(studyQueue);
        }

        function updateProgressDots() {
            const container = document.getElementById('progress-dots');
            container.innerHTML = '';
            for (let i = 0; i < studyQueue.length; i++) {
                const dot = document.createElement('span');
                dot.className = `progress-dot ${i < currentIndex ? 'completed' : ''}`;
                container.appendChild(dot);
            }
        }

        function showTask() {
            if (currentIndex >= studyQueue.length) {
                endStudy();
                return;
            }
            
            const task = studyQueue[currentIndex];
            updateProgressDots();
            
            switch(task.type) {
                case 'intro': showIntroCard(task.word); break;
                case 'choice_char': showChoiceCharCard(task.word); break;
                case 'choice_trans': showChoiceTransCard(task.word); break;
                case 'char_from_trans': showCharFromTransCard(task.word); break;
                case 'listening': showListeningCard(task.word); break;
                case 'compose': showComposeCard(task.word); break;
                case 'matching': showMatchingCard(task.word); break;
                case 'review': showReviewCard(task.word); break;
            }
        }

        function showIntroCard(word) {
            document.getElementById('card-content').innerHTML = `
                <div class="choice-char-trans-only">
                    <div class="chinese-char">${word.characters}</div>
                    <div class="pinyin">${word.pinyin}</div>
                    <div class="translation">${word.translation}</div>
                    <div class="audio-btn" onclick="speak('${word.characters}')">üîä</div>
                    <div class="example-box">
                        <div class="example-chinese">${word.example}</div>
                        <div class="example-translation">${word.exampleTranslation}</div>
                    </div>
                    <button class="red-button" onclick="handleIntro('${word.id}')">–î–∞–ª–µ–µ</button>
                </div>
            `;
        }

        function handleIntro(wordId) {
            const word = wordsData.find(w => w.id == wordId);
            word.timesReviewed++;
            word.lastReviewed = Date.now();
            saveUserProgress();
            currentIndex++;
            showTask();
        }

        function showChoiceCharCard(word) {
            const blockWords = getWordsByBlock(word.listId).filter(w => w.id !== word.id);
            const options = shuffleArray([word, ...shuffleArray(blockWords).slice(0, 3)]);
            
            document.getElementById('card-content').innerHTML = `
                <div class="choice-char-trans-only">
                    <div class="translation-big">${word.translation}</div>
                    <div class="options-vertical">
                        ${options.map(opt => `
                            <div class="option-vertical-item" onclick="checkCharAnswer(this, '${opt.characters}', '${word.characters}', '${word.id}')">
                                <span class="chinese-small">${opt.characters}</span>
                                <span class="pinyin-small">${opt.pinyin}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function showChoiceTransCard(word) {
            const blockWords = getWordsByBlock(word.listId).filter(w => w.id !== word.id);
            const options = shuffleArray([word, ...shuffleArray(blockWords).slice(0, 3)]);
            
            document.getElementById('card-content').innerHTML = `
                <div class="choice-char-trans-only">
                    <div class="chinese-char">${word.characters}</div>
                    <div class="audio-btn" onclick="speak('${word.characters}')">üîä</div>
                    <div class="options-vertical">
                        ${options.map(opt => `
                            <div class="option-vertical-item" onclick="checkTranslationAnswer(this, '${opt.translation}', '${word.translation}', '${word.id}')">
                                <span class="pinyin-small">${opt.translation}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function showCharFromTransCard(word) {
            const blockWords = getWordsByBlock(word.listId).filter(w => w.id !== word.id);
            const options = shuffleArray([word, ...shuffleArray(blockWords).slice(0, 3)]);
            
            document.getElementById('card-content').innerHTML = `
                <div class="choice-char-trans-only">
                    <div class="translation-big">${word.translation}</div>
                    <div class="options-vertical">
                        ${options.map(opt => `
                            <div class="option-vertical-item" onclick="checkCharAnswer(this, '${opt.characters}', '${word.characters}', '${word.id}')">
                                <span class="chinese-small">${opt.characters}</span>
                                <span class="pinyin-small">${opt.pinyin}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function showListeningCard(word) {
            const blockWords = getWordsByBlock(word.listId).filter(w => w.id !== word.id);
            const options = shuffleArray([word, ...shuffleArray(blockWords).slice(0, 3)]);
            
            setTimeout(() => speak(word.characters), 500);
            
            document.getElementById('card-content').innerHTML = `
                <div class="choice-char-trans-only">
                    <div class="audio-btn" onclick="speak('${word.characters}')">üîä</div>
                    <div style="text-align: center; margin: 20px; color: #666;">–ü—Ä–æ—Å–ª—É—à–∞–π—Ç–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–æ</div>
                    <div class="options-vertical">
                        ${options.map(opt => `
                            <div class="option-vertical-item" onclick="checkCharAnswer(this, '${opt.characters}', '${word.characters}', '${word.id}')">
                                <span class="chinese-small">${opt.characters}</span>
                                <span class="pinyin-small">${opt.pinyin}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function showComposeCard(word) {
            const chars = word.characters.split('');
            const shuffledChars = shuffleArray([...chars]);
            
            document.getElementById('card-content').innerHTML = `
                <div class="choice-char-trans-only">
                    <div class="translation">${word.translation}</div>
                    <div class="char-options">
                        ${shuffledChars.map(char => `
                            <div class="char-btn" onclick="selectChar(this, '${char}')">${char}</div>
                        `).join('')}
                    </div>
                    <div style="margin: 20px; min-height: 70px; padding: 15px; background: white; border-radius: 12px; text-align: center; font-size: 32px; border: 2px solid #FFE4E1;" id="composed-word"></div>
                    <button class="red-button" onclick="checkComposedWord('${word.characters}', '${word.id}')">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                </div>
            `;
            window.selectedChars = [];
        }

        function showMatchingCard(word) {
            const chars = word.characters.split('');
            const pinyins = word.pinyin.split(' ');
            
            let html = `
                <div class="matching-section">
                    <div class="matching-title">–®–∞–≥ 1: –°–æ–ø–æ—Å—Ç–∞–≤—å—Ç–µ –∏–µ—Ä–æ–≥–ª–∏—Ñ—ã —Å–æ —Å–ª–æ–≥–∞–º–∏</div>
                    <div class="char-pinyin-grid" id="step1-grid">
            `;
            
            chars.forEach((char, index) => {
                const pinyinOptions = [pinyins[index]];
                const otherWords = getWordsByBlock(word.listId).filter(w => w.id !== word.id);
                for (let i = 0; i < 2; i++) {
                    if (otherWords[i]) {
                        const otherPinyins = otherWords[i].pinyin.split(' ');
                        pinyinOptions.push(otherPinyins[0]);
                    }
                }
                const shuffledPinyins = shuffleArray(pinyinOptions);
                
                html += `
                    <div class="char-pinyin-row" data-char-index="${index}">
                        <span class="char">${char}</span>
                        <div class="pinyin-options">
                `;
                
                shuffledPinyins.forEach(p => {
                    html += `<span class="pinyin-option" onclick="selectPinyin(this, ${index}, '${pinyins[index]}')">${p}</span>`;
                });
                
                html += `</div></div>`;
            });
            
            html += `
                    </div>
                    <div class="matching-title" style="margin-top: 20px;">–®–∞–≥ 2: –°–æ–ø–æ—Å—Ç–∞–≤—å—Ç–µ —Å–ª–æ–≤–æ —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º</div>
                    <div class="word-translation-grid" id="step2-grid">
            `;
            
            const transOptions = [word.translation];
            const otherWords = getWordsByBlock(word.listId).filter(w => w.id !== word.id);
            for (let i = 0; i < 2; i++) {
                if (otherWords[i]) {
                    transOptions.push(otherWords[i].translation);
                }
            }
            const shuffledTrans = shuffleArray(transOptions);
            
            html += `
                        <div class="word-translation-row">
                            <span class="word">${word.characters}</span>
                            <div class="trans-options">
            `;
            
            shuffledTrans.forEach(t => {
                html += `<span class="trans-option" onclick="selectTranslation(this, '${word.translation}', '${word.id}')">${t}</span>`;
            });
            
            html += `</div></div></div></div>`;
            
            document.getElementById('card-content').innerHTML = html;
        }

        window.selectPinyin = function(element, charIndex, correctPinyin) {
            if (element.classList.contains('matched')) return;
            
            const row = element.closest('.char-pinyin-row');
            const rowOptions = row.querySelectorAll('.pinyin-option');
            
            rowOptions.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            
            if (element.textContent === correctPinyin) {
                element.classList.remove('selected');
                element.classList.add('matched');
                showFeedback(true);
            } else {
                showFeedback(false);
                setTimeout(() => element.classList.remove('selected'), 500);
            }
        };

        window.selectTranslation = function(element, correctTranslation, wordId) {
            if (element.classList.contains('matched')) return;
            
            const transOptions = document.querySelectorAll('.trans-option');
            transOptions.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            
            if (element.textContent === correctTranslation) {
                element.classList.remove('selected');
                element.classList.add('matched');
                showFeedback(true);
                
                const word = wordsData.find(w => w.id == wordId);
                word.correctCount++;
                word.timesReviewed++;
                word.lastReviewed = Date.now();
                if (word.correctCount >= 5) word.mastered = 5;
                saveUserProgress();
                
                setTimeout(() => {
                    showIntroCard(word);
                }, 1000);
            } else {
                showFeedback(false);
                setTimeout(() => element.classList.remove('selected'), 500);
            }
        };

        function showReviewCard(word) {
            document.getElementById('card-content').innerHTML = `
                <div class="choice-char-trans-only">
                    <div class="chinese-char">${word.characters}</div>
                    <div class="pinyin">${word.pinyin}</div>
                    <div class="translation">${word.translation}</div>
                    <div class="audio-btn" onclick="speak('${word.characters}')">üîä</div>
                    <div style="display: flex; gap: 10px; padding: 20px; width: 100%;">
                        <button class="red-button" onclick="handleReview('${word.id}', true)" style="flex: 1;">–ü–æ–º–Ω—é</button>
                        <button class="red-button-outline" onclick="handleReview('${word.id}', false)" style="flex: 1;">–ù–µ –ø–æ–º–Ω—é</button>
                    </div>
                </div>
            `;
        }

        window.checkCharAnswer = function(element, selected, correct, wordId) {
            const word = wordsData.find(w => w.id == wordId);
            
            document.querySelectorAll('.option-vertical-item').forEach(el => {
                el.classList.remove('correct', 'wrong');
            });
            
            if (selected === correct) {
                element.classList.add('correct');
                showFeedback(true);
                word.correctCount++;
                word.timesReviewed++;
                word.lastReviewed = Date.now();
                if (word.correctCount >= 5) word.mastered = 5;
                saveUserProgress();
                
                setTimeout(() => {
                    showIntroCard(word);
                }, 1000);
            } else {
                element.classList.add('wrong');
                showFeedback(false);
                setTimeout(() => element.classList.remove('wrong'), 500);
            }
        };

        window.checkTranslationAnswer = function(element, selected, correct, wordId) {
            const word = wordsData.find(w => w.id == wordId);
            
            document.querySelectorAll('.option-vertical-item').forEach(el => {
                el.classList.remove('correct', 'wrong');
            });
            
            if (selected === correct) {
                element.classList.add('correct');
                showFeedback(true);
                word.correctCount++;
                word.timesReviewed++;
                word.lastReviewed = Date.now();
                if (word.correctCount >= 5) word.mastered = 5;
                saveUserProgress();
                
                setTimeout(() => {
                    showIntroCard(word);
                }, 1000);
            } else {
                element.classList.add('wrong');
                showFeedback(false);
                setTimeout(() => element.classList.remove('wrong'), 500);
            }
        };

        function selectChar(btn, char) {
            if (!window.selectedChars) window.selectedChars = [];
            window.selectedChars.push(char);
            document.getElementById('composed-word').textContent = window.selectedChars.join('');
            btn.classList.add('disabled');
        }

        function checkComposedWord(correct, wordId) {
            const word = wordsData.find(w => w.id == wordId);
            const composed = window.selectedChars ? window.selectedChars.join('') : '';
            
            if (composed === correct) {
                showFeedback(true);
                word.correctCount++;
                word.timesReviewed++;
                word.lastReviewed = Date.now();
                if (word.correctCount >= 5) word.mastered = 5;
                saveUserProgress();
                
                setTimeout(() => {
                    showIntroCard(word);
                }, 1000);
            } else {
                showFeedback(false);
            }
        }

        function handleReview(wordId, remembered) {
            const word = wordsData.find(w => w.id == wordId);
            
            if (remembered) {
                showFeedback(true);
                word.correctCount++;
                word.timesReviewed++;
                word.lastReviewed = Date.now();
                if (word.correctCount >= 5) word.mastered = 5;
                saveUserProgress();
            } else {
                showFeedback(false);
            }
            
            setTimeout(() => {
                currentIndex++;
                showTask();
            }, 1000);
        }

        function endStudy() {
            saveUserProgress();
            document.getElementById('study-screen').classList.remove('active');
            document.getElementById('post-study-screen').classList.add('active');
            document.getElementById('study-result').textContent = 
                `–ó–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –≤—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ ${currentIndex} –∑–∞–¥–∞–Ω–∏–π`;
            renderBlocksScreen();
            updateReviewBanner();
        }

        // ============================================
        // –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò: –ö–ê–†–¢–û–ß–ö–ò –°–õ–û–í –ò –ó–ê–í–ï–†–®–ï–ù–ò–ï –ë–õ–û–ö–ê
        // ============================================
        
        function showWordCard(wordId) {
            const word = wordsData.find(w => w.id === wordId);
            
            document.getElementById('word-card-content').innerHTML = `
                <div class="word-card">
                    <div class="word-card-chinese">${word.characters}</div>
                    <div class="word-card-pinyin">${word.pinyin}</div>
                    <div class="word-card-translation">${word.translation}</div>
                    <div class="word-card-audio" onclick="speak('${word.characters}')">üîä</div>
                    <div class="word-card-example">
                        <div class="word-card-example-chinese">${word.example}</div>
                        <div class="word-card-example-translation">${word.exampleTranslation}</div>
                    </div>
                    <button class="word-card-close" onclick="goBackToBlock()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            
            showScreen('word-card-screen');
        }

        function goBackToBlock() {
            showScreen('block-detail-screen');
        }

        function checkBlockCompletion(blockId) {
            const words = getWordsByBlock(blockId);
            const allMastered = words.every(w => w.mastered >= 5);
            
            if (allMastered) {
                showScreen('block-complete-screen');
            }
        }

        function startReview(blockId) {
            const allWords = getWordsByBlock(blockId);
            const masteredWords = allWords.filter(w => w.mastered >= 5);
            
            if (masteredWords.length === 0) {
                alert('–ù–µ—Ç –≤—ã—É—á–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è');
                return;
            }
            
            // –ë–µ—Ä–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ 10 —Å–ª–æ–≤ –∏–∑ –≤—ã—É—á–µ–Ω–Ω—ã—Ö
            studyWords = shuffleArray(masteredWords).slice(0, 10);
            createStudyQueue();
            currentIndex = 0;
            
            showScreen('study-screen');
            updateProgressDots();
            showTask();
        }

        // ============================================
        // –§–£–ù–ö–¶–ò–ò –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø
        // ============================================
        
        function renderBlocksScreen() {
            const stats = getTotalStats();
            document.getElementById('total-mastered').textContent = stats.mastered;
            document.getElementById('total-words').textContent = stats.total;
            document.getElementById('total-progress').style.width = (stats.mastered / stats.total * 100) + '%';
            
            const container = document.getElementById('blocks-container');
            container.innerHTML = '';
            
            blocks.forEach(block => {
                const blockStats = getBlockStats(block.id);
                const progress = (blockStats.mastered / block.count * 100) || 0;
                
                container.innerHTML += `
                    <div class="block-card" data-block="${block.id}">
                        <div class="block-header">
                            <span class="block-icon">${block.icon}</span>
                            <span class="block-name">${block.name}</span>
                        </div>
                        <div class="block-stats">
                            <span>${blockStats.mastered}/${block.count}</span>
                            <span>${Math.round(progress)}%</span>
                        </div>
                        <div class="block-progress">
                            <div class="block-progress-fill" style="width: ${progress}%"></div>
                        </div>
                    </div>
                `;
            });
            
            document.querySelectorAll('.block-card').forEach(card => {
                card.addEventListener('click', () => {
                    const blockId = parseInt(card.dataset.block);
                    showBlockDetail(blockId);
                });
            });
            
            updateReviewBanner();
        }

        function showBlockDetail(blockId) {
            currentBlock = blockId;
            const block = blocks.find(b => b.id === blockId);
            document.getElementById('block-title').textContent = block.name;
            
            const stats = getBlockStats(blockId);
            document.getElementById('block-mastered-circle').textContent = stats.mastered;
            document.getElementById('block-total-circle').textContent = block.count;
            document.getElementById('block-mastered-count').textContent = `${stats.mastered}/${block.count}`;
            document.getElementById('block-progress-bar').style.width = (stats.mastered / block.count * 100) + '%';
            
            const percentage = (stats.mastered / block.count * 100) || 0;
            updateCircleProgress(percentage);
            
            const words = getWordsByBlock(blockId);
            const container = document.getElementById('words-list-container');
            container.innerHTML = '';
            
            words.forEach(word => {
                container.innerHTML += `
                    <div class="word-item" data-word-id="${word.id}">
                        <div class="word-item-left">
                            <span class="chinese">${word.characters}</span>
                            <span class="pinyin-small">${word.pinyin}</span>
                            <span class="translation-small">${word.translation}</span>
                        </div>
                        ${word.mastered >= 5 ? 
                            '<span class="mastered-badge">‚úì –í—ã—É—á–µ–Ω–æ</span>' : 
                            '<span class="not-mastered-badge">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>'}
                    </div>
                `;
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –Ω–∞ —Å–ª–æ–≤–∞
            document.querySelectorAll('.word-item').forEach(item => {
                item.addEventListener('click', () => {
                    const wordId = parseInt(item.dataset.wordId);
                    showWordCard(wordId);
                });
            });
            
            showScreen('block-detail-screen');
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadUsers();
        loadUserProgress();

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        document.getElementById('login-btn').addEventListener('click', () => {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (users[email] && users[email].password === password) {
                currentUser = email;
                loadUserProgress();
                updateUserUI();
                showScreen('hsk-screen');
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
            }
        });

        document.getElementById('register-btn').addEventListener('click', () => {
            showScreen('register-screen');
        });

        document.getElementById('back-to-auth').addEventListener('click', () => {
            showScreen('auth-screen');
        });

        document.getElementById('register-submit-btn').addEventListener('click', () => {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;
            
            if (!name || !email || !password) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            if (password !== confirm) {
                alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                return;
            }
            
            if (users[email]) {
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }
            
            users[email] = {
                name: name,
                email: email,
                password: password,
                progress: {}
            };
            
            saveUsers();
            alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.');
            showScreen('auth-screen');
        });

        document.getElementById('guest-link').addEventListener('click', () => {
            currentUser = null;
            updateUserUI();
            showScreen('hsk-screen');
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã—Ö–æ–¥–∞
        document.querySelectorAll('[id^="logout-btn"]').forEach(btn => {
            btn.addEventListener('click', logout);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.querySelectorAll('.hsk-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.hsk-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                currentHSK = parseInt(card.dataset.hsk);
            });
        });

        document.getElementById('select-hsk-btn').addEventListener('click', () => {
            renderBlocksScreen();
            showScreen('blocks-screen');
        });

        document.getElementById('back-to-hsk').addEventListener('click', () => {
            showScreen('hsk-screen');
        });

        document.getElementById('back-to-blocks').addEventListener('click', () => {
            showScreen('blocks-screen');
        });

        document.getElementById('back-to-block-from-card').addEventListener('click', () => {
            showScreen('block-detail-screen');
        });

        document.getElementById('study-block-btn').addEventListener('click', () => {
            startStudy(currentBlock, true);
        });

        document.getElementById('skip-btn').addEventListener('click', () => {
            currentIndex++;
            showTask();
        });

        document.getElementById('continue-study').addEventListener('click', () => {
            startStudy(studyBlockId, false);
        });

        document.getElementById('back-to-block-after').addEventListener('click', () => {
            showScreen('block-detail-screen');
            showBlockDetail(studyBlockId);
        });

        document.getElementById('review-block-btn').addEventListener('click', () => {
            startReview(currentBlock);
        });

        document.getElementById('back-to-blocks-complete').addEventListener('click', () => {
            showScreen('blocks-screen');
        });

        document.getElementById('review-banner').addEventListener('click', () => {
            const reviewWords = getWordsForReview();
            if (reviewWords.length > 0) {
                studyWords = reviewWords.slice(0, 3);
                createStudyQueue();
                currentIndex = 0;
                showScreen('study-screen');
                updateProgressDots();
                showTask();
            }
        });

        window.addEventListener('beforeunload', () => {
            saveUserProgress();
        });
        
        window.speechSynthesis.getVoices();
    </script>
</body>
</html>
